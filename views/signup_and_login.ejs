<html lang="en">
<head>
    <link rel="stylesheet" href="/styles/signup_and_login.css">
</head>
<body>
    <!-- successful signup message -->
    <div class="popup-signup-success" id="popup-signup-success">
        <div class="popup-window">
            <div class="popup-tophalf">
                <div class="checkmark-circle">
                <div class="checkmark-stem"></div>
                </div>
            </div>
            <div class="popup-bottomhalf">
                <div class ="popup-text">
                    <h1>Success!</h1>
                    <h2>Account was Created</h2>
                    <div class="popup-button">
                        <button type="button" onclick="closePopup()">Continue</button>
                    </div> 
                </div>
            </div>
        </div>
    </div> 
     <!-- successful login message -->
     <div class="popup-login-success" id="popup-login-success">
        <div class="popup-window">
            <div class="popup-tophalf">
                <div class="checkmark-circle">
                <div class="checkmark-stem"></div>
                </div>
            </div>
            <div class="popup-bottomhalf">
                <div class ="popup-text">
                    <h1>Success!</h1>
                    <h2>Logged in Successfully</h2>
                    <div class="popup-button">
                        <button type="button" onclick="closePopup()">Continue</button>
                    </div> 
                </div>
            </div>
        </div>
    </div> 
    <!-- fail message -->
    <div class="popup-screen-fail" id="popup-screen-fail">
        <div class="popup-window">
            <div class="popup-tophalf">
                <div class="checkmark-circle">
                <div class="checkmark-stem"></div>
                </div>
            </div>
            <div class="popup-bottomhalf-fail">
                <div class ="popup-text">
                    <h1>Error!</h1>
                    <h2>An Error Has Occurd</h2>
                    <div class="popup-button">
                        <button type="button" onclick="failClosePopup()">Continue</button>
                    </div> 
                </div>
            </div>
        </div>
    </div> 
    <%- include('./partials/nav.ejs') %>
    <div class="container" id="container">
        <div class="form-container sign-up-container">
            <form id="signup-form">
                <h1 class="active_title">Sign Up</h1>
                <input type="text" id="name" placeholder="Full Name" />
                <input type="email" id="signup-email" placeholder="Email" />
                <input type="password" id="signup-password" placeholder="Password" />
                <button class ="active_signup">Sign Up</button>
            </form>
        </div>

        <div class="form-container sign-in-container">
            <form id="login-form">
                <h1 class="active_title">Sign In</h1>
                <input type="email" id="login-email" placeholder="Email" />
                <input type="password" id="login-password" placeholder="Password" />
                <a href="#">Forgot your password?</a>
                <button>Sign In</button>
            </form>
        </div>

        <div class="overlay-container">
            <div class="overlay">
                <div class="overlay-panel overlay-left">
                    <h1>Welcome Back!</h1>
                    <h2>To access your account please log in with your personal info!</h2>
                    <button class="ghost" id="signin">Sign In</button>
                </div>
                <div class="overlay-panel overlay-right">
                    <h1>Hello Friend!</h1>
                    <h2>Enter your personal details and start your journey with us!</h2>
                    <button class="ghost" id="signup">Sign Up</button>
                </div>
            </div>
        </div>
    </div>
    <%- include('./partials/footer.ejs') %>   

    <script>
        const signUpButton = document.getElementById('signup');
        const signInButton = document.getElementById('signin');
        const container = document.getElementById('container');

        const signup_success_popup = document.getElementById('popup-signup-success')
        const login_success_popup = document.getElementById('popup-login-success')
        const fail_popup = document.getElementById('popup-screen-fail')

        signUpButton.addEventListener('click', () => {
            container.classList.add("right-panel-active");
        });

        signInButton.addEventListener('click', () => {
            container.classList.remove("right-panel-active");
        });


        const signup_form = document.getElementById('signup-form')
        signup_form.addEventListener('submit', signupUser)
        async function signupUser(event) {
            event.preventDefault() // This will prevent the refresh event
            const name = document.getElementById('name').value
            const email = document.getElementById('signup-email').value
            const password = document.getElementById('signup-password').value

            const result = await fetch('/api/signup', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify ({
                    name,
                    email,
                    password
                })
            }).then((res) => res)
            if (result.status === 200) {
                signup_success_popup.classList.add("popup-screen-success")
                signup_success_popup.classList.add("open-popup")
            }
            else {
                fail_popup.classList.add("popup-screen-fail")
                fail_popup.classList.add("open-popup") 
            }
        }

        const login_form = document.getElementById('login-form')
        login_form.addEventListener('submit', loginUser)
        async function loginUser(event) {
            event.preventDefault() // This will prevent the refresh event
            const email = document.getElementById('login-email').value
            const password = document.getElementById('login-password').value

            const result = await fetch('/api/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify ({
                    email,
                    password
                })
            })
            const token = await result.json();
            if(result.status === 200) {
                localStorage.setItem('token', token)
                login_success_popup.classList.add("popup-screen-success")
                login_success_popup.classList.add("open-popup")
            }
            else {
                fail_popup.classList.add("popup-screen-fail")
                fail_popup.classList.add("open-popup") 
            }
        }

        function closePopup() {
            signup_success_popup.classList.add("close-popup")
            signup_success_popup.classList.remove("open-popup");
            signup_success_popup.classList.remove("close-popup")

            login_success_popup.classList.add("close-popup")
            login_success_popup.classList.remove("open-popup");
            login_success_popup.classList.remove("close-popup")

            // send user to home screen after loggin in
            window.location.href="/"    
        }

        function failClosePopup() {
            fail_popup.classList.add("close-popup")
            fail_popup.classList.remove("open-popup");
            fail_popup.classList.remove("close-popup")
        }
    </script>
</body>
</html>