<html lang="en">
<head>
    <link rel="stylesheet" href="/styles/signup_and_login.css">
</head>
<body>
    <%- include('./partials/nav.ejs') %>
    <div class="container" id="container">
        <div class="form-container sign-up-container">
            <form id="signup-form">
                <% if (typeof error != 'undefined') { %>
                    <p class="error_message" id="error_flag">INVALID</p>
                <% } %>
                <h1 class="active_title">Sign Up</h1>
                <input type="text" id="name" placeholder="Full Name" />
                <input type="email" id="signup-email" placeholder="Email" />
                <input type="password" id="signup-password" placeholder="Password" />
                <button class ="active_signup">Sign Up</button>
            </form>
        </div>

        <div class="form-container sign-in-container">
            <form id="login-form">
                <p class="error_message" id="error_flag"></p>
                <h1 class="active_title">Sign In</h1>
                <input type="email" id="login-email" placeholder="Email" />
                <input type="password" id="login-password" placeholder="Password" />
                <a href="#">Forgot your password?</a>
                <button>Sign In</button>
            </form>
        </div>

        <div class="overlay-container">
            <div class="overlay">
                <div class="overlay-panel overlay-left">
                    <h1>Welcome Back!</h1>
                    <h2>To access your account please log in with your personal info!</h2>
                    <button class="ghost" id="signin">Sign In</button>
                </div>
                <div class="overlay-panel overlay-right">
                    <h1>Hello Friend!</h1>
                    <h2>Enter your personal details and start your journey with us!</h2>
                    <button class="ghost" id="signup">Sign Up</button>
                </div>
            </div>
        </div>
    </div>
    <%- include('./partials/footer.ejs') %>   

    <script>
        const signUpButton = document.getElementById('signup');
        const signInButton = document.getElementById('signin');
        const container = document.getElementById('container');

        signUpButton.addEventListener('click', () => {
            container.classList.add("right-panel-active");
        });

        signInButton.addEventListener('click', () => {
            container.classList.remove("right-panel-active");
        });

        const signup_form = document.getElementById('signup-form')
        signup_form.addEventListener('submit', signupUser)

        async function signupUser(event) {
            event.preventDefault() // This will prevent the refresh event
            const name = document.getElementById('name').value
            const email = document.getElementById('signup-email').value
            const password = document.getElementById('signup-password').value

            const result = await fetch('/api/signup', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify ({
                    name,
                    email,
                    password
                })
            })
            const something = await result;
            if (result.status === 200) {
            }
            else {
            }
        }

        const login_form = document.getElementById('login-form')
        login_form.addEventListener('submit', loginUser)

        const error = document.getElementById('login_error_flag')

        async function loginUser(event) {
            event.preventDefault() // This will prevent the refresh event
            const email = document.getElementById('login-email').value
            const password = document.getElementById('login-password').value

            const result = await fetch('/api/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify ({
                    email,
                    password
                })
            })  
            const reqResult = await result
            const message = await result.json()
            if (reqResult.status === 200)
                location.reload(true);
            else
                document.getElementById("error_flag").innerHTML = message['message']
        }
    </script>
</body>
</html>